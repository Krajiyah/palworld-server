# Palworld Dedicated Server on AWS

Complete production-ready infrastructure for deploying a Palworld dedicated server on AWS using Terraform with Spot instances, auto-generated passwords, persistent storage, and automated backups.

## ğŸ® Quick Access

**Game Server (Connect in Palworld):**
```
IP: 54.153.62.79:8211
```

**Dashboard (Monitor Server):**
```
http://54.153.62.79
```

**SSH Access:**
```bash
ssh -i palworld-server-key.pem ubuntu@54.153.62.79
```

**Get Passwords:**
```bash
# Server password (give to players):
terraform output -raw server_password

# Admin password (keep secret):
terraform output -raw admin_password
```

---

## Table of Contents

- [Features](#features)
- [Platform Support](#platform-support)
- [Cost Breakdown](#cost-breakdown)
- [Prerequisites](#prerequisites)
- [Quick Start](#quick-start)
- [Password Management](#password-management)
- [SSH Security & IP Detection](#ssh-security--ip-detection)
- [Remote State Setup](#remote-state-setup)
- [Management](#management)
- [Monitoring](#monitoring)
- [Troubleshooting](#troubleshooting)
- [Security Best Practices](#security-best-practices)
- [Architecture](#architecture)
- [Credits](#credits)

## Features

- âœ… **Cost-Optimized**: EC2 Spot instances (~70% cheaper) with auto-recovery
- âœ… **Zero Data Loss**: Persistent EBS volume survives Spot interruptions
- âœ… **Static IP**: Elastic IP address stays constant across interruptions
- âœ… **Auto-Generated Passwords**: Terraform creates strong random passwords
- âœ… **Secrets Manager Integration**: Passwords stored securely in AWS Secrets Manager
- âœ… **Automatic IP Detection**: SSH auto-restricted to your current IP
- âœ… **Automated Backups**: S3 backups every 6 hours + Spot interruption handling
- âœ… **Monitoring Dashboard**: Real-time CPU, memory, and player count metrics
- âœ… **Cross-Platform**: Supports Steam, Xbox Game Pass PC, Windows Store
- âœ… **Secure**: ED25519 SSH keys, auto-detected IP restrictions
- âœ… **One-Command Deploy**: `terraform apply` to create, `terraform destroy` to remove
- âœ… **Remote State**: Optional S3 backend for state storage

## Platform Support

| Platform | Supported |
|----------|-----------|
| Steam (PC) | âœ… Yes |
| Xbox Game Pass (PC) | âœ… Yes |
| Windows Store (PC) | âœ… Yes |
| PS5 Console | âŒ No (dedicated servers not supported by Palworld) |
| Xbox Console | âŒ No (dedicated servers not supported by Palworld) |

## Cost Breakdown

**Monthly costs (24/7 runtime in us-west-1):**
- EC2 Spot t3.xlarge (16GB RAM, 4 vCPU): ~$40.00/month
- EBS 50GB gp3 volume: ~$4.80/month
- S3 storage (backups): ~$1.00/month
- AWS Secrets Manager (2 secrets): ~$0.80/month
  - Passwords secret: $0.40/month
  - SSH key secret: $0.40/month
- S3 remote state (optional): ~$0.01/month
- **Total: ~$46.61/month**

**With $100 AWS credits**: Approximately **2.2 months** of 24/7 runtime

**To extend credits**: Manually start/stop the server when not in use, or run only during specific hours.

## Prerequisites

1. **AWS Account** with $100 free credits
2. **Terraform** installed ([Download](https://www.terraform.io/downloads))
3. **AWS CLI** installed (optional but recommended)
4. **curl or jq** for retrieving passwords (usually pre-installed)

## Quick Start

### 1. Configure AWS Credentials

```bash
cd /home/anton/Desktop/palworld-server

# Load AWS credentials
source .env

# Verify credentials are loaded
echo $AWS_ACCESS_KEY_ID
```

### 2. Review Configuration (Optional)

The `terraform.tfvars` file is already configured with sensible defaults. You can optionally customize:

```hcl
palworld_server_name = "My Server Name"    # Your server's display name
palworld_max_players = 16                  # Max concurrent players (16GB RAM supports ~10-20)
restrict_ssh_to_current_ip = true          # Auto-detect and restrict SSH to your IP (recommended!)
enable_dashboard = true                    # Enable web monitoring dashboard
backup_cron_schedule = "0 */6 * * *"       # Every 6 hours
```

**ğŸ” Passwords**: Auto-generated by Terraform! No manual entry needed.
**ğŸ”’ SSH Security**: Set `restrict_ssh_to_current_ip = true` to automatically restrict SSH access to your current public IP.

### 3. Initialize Terraform

```bash
terraform init
```

Expected output:
```
Terraform has been successfully initialized!
```

### 4. Review the Plan

```bash
terraform plan
```

This shows what will be created. Review it carefully.

### 5. Deploy the Server

```bash
terraform apply
```

Type `yes` when prompted. Deployment takes **~2-3 minutes** for infrastructure, then **~10 minutes** for the server to download and start.

### 6. Get Connection Info & Passwords

```bash
# Get all connection info
terraform output server_connection_info

# Option 1: Get passwords via Terraform (fastest)
terraform output -raw server_password    # Give this to players
terraform output -raw admin_password     # Keep this secret!

# Option 2: Get passwords via AWS Secrets Manager (survives state loss)
aws secretsmanager get-secret-value \
  --secret-id $(terraform output -raw secrets_manager_name) \
  --region us-west-1 \
  --query SecretString \
  --output text | jq .

# Option 3: Check SSH access configuration
terraform output ssh_access_info

# Save passwords to files
terraform output -raw server_password > server_password.txt
terraform output -raw admin_password > admin_password.txt
```

You'll see:
- Server IP address
- SSH command
- Dashboard URL
- How to retrieve passwords

### 7. Monitor Server Startup

```bash
# Get the server IP
SERVER_IP=$(terraform output -raw server_public_ip)

# SSH into the server
ssh -i palworld-server-key.pem ubuntu@$SERVER_IP

# Watch the installation logs
journalctl -xu palworld -f

# Check Docker status
docker ps
```

Wait for the message "Palworld server is ready" (~10 minutes).

### 8. Connect to Your Server

**Get your server password first:**
```bash
terraform output -raw server_password
```

**From Palworld Game:**
1. Open Palworld
2. Go to "Join Multiplayer Game"
3. Click "Add Server" or "Join Code"
4. Enter: `<SERVER_IP>:8211`
5. Enter the password from above

**Or add via Steam:**
1. Steam â†’ View â†’ Servers
2. Favorites tab â†’ Add Server
3. Enter: `<SERVER_IP>:8211`
4. Enter the server password when prompted

## Password Management

### Auto-Generated Passwords

Two passwords are automatically created when you run `terraform apply`:

1. **Server Password** (16 characters) - Used by players to join your server
2. **Admin Password** (20 characters) - Used for RCON server management and dashboard access

Both passwords are:
- Cryptographically secure
- Include uppercase, lowercase, numbers, and symbols
- Never stored in your codebase
- Automatically stored in AWS Secrets Manager

### Retrieving Passwords

#### Option 1: Terraform Outputs (Fastest)

```bash
# Server password (give this to your players)
terraform output -raw server_password

# Admin password (keep this secret!)
terraform output -raw admin_password
```

#### Option 2: AWS Secrets Manager (Recommended for Teams)

```bash
# Get secret name
SECRET_NAME=$(terraform output -raw secrets_manager_name)

# Retrieve all passwords as JSON
aws secretsmanager get-secret-value \
  --secret-id $SECRET_NAME \
  --region us-west-1 \
  --query SecretString \
  --output text | jq .
```

**JSON Output Example:**
```json
{
  "server_password": "Xy9#kL2@pQ5vW8nM",
  "admin_password": "R7!tY4$uI1oP3@sA6zX9cV",
  "server_ip": "54.123.45.67",
  "server_port": 8211,
  "dashboard_url": "http://54.123.45.67",
  "created_at": "2025-01-15T10:30:00Z",
  "notes": "Server password: give to players. Admin password: keep secret for RCON/dashboard."
}
```

#### Option 3: AWS Console

1. Navigate to AWS Secrets Manager in the AWS Console
2. Find the secret named `palworld-server-passwords-*`
3. Click "Retrieve secret value"
4. View the JSON containing both passwords plus server info

### Rotating Passwords

If someone leaves your group or password is compromised:

```bash
# Force password regeneration
terraform taint random_password.server_password
terraform taint random_password.admin_password
terraform apply

# Get new passwords
terraform output -raw server_password
terraform output -raw admin_password
```

**âš ï¸ Warning**: All players will need the new password! Secrets Manager is automatically updated.

### Password Storage Security

Passwords are securely stored in:

1. **AWS Secrets Manager** (Primary, Recommended)
   - Encrypted at rest with AWS KMS
   - Access controlled via IAM policies
   - Audit logging through CloudTrail
   - Survives Terraform state loss
   - Cost: ~$0.40/month

2. **Terraform State File** (`terraform.tfstate`)
   - Encrypted if using remote backend (S3)
   - Listed in `.gitignore` to prevent Git commits
   - **NEVER commit this file to version control!**

### SSH Private Key Storage

The ED25519 SSH private key is stored in **three locations**:

1. **Local File** (`palworld-server-key.pem`)
   - Created during first `terraform apply`
   - Used for SSH access
   - Permissions: `0400` (read-only for owner)
   - **In `.gitignore` - never committed to Git**

2. **AWS Secrets Manager** (Backup)
   - Encrypted at rest with AWS KMS
   - Retrievable from any machine with AWS access
   - Cost: ~$0.40/month
   - Includes public key and SSH command

3. **Terraform State** (`terraform.tfstate`)
   - Stored in S3 if remote backend enabled
   - Encrypted if S3 encryption enabled

**To retrieve SSH key from Secrets Manager:**
```bash
aws secretsmanager get-secret-value \
  --secret-id $(terraform output -raw ssh_key_secret_name) \
  --region us-west-1 \
  --query SecretString --output text | jq -r .private_key > palworld-server-key.pem

chmod 400 palworld-server-key.pem
```

### Sharing Passwords with Players

When giving the password to friends:

1. **Retrieve the password:**
   ```bash
   terraform output -raw server_password
   ```

2. **Share securely:**
   - Send via encrypted messaging (Signal, WhatsApp)
   - Share in person
   - Use a temporary password sharing service (OneTimeSecret.com)
   - **Avoid**: Plain text email, Discord, Slack

## SSH Security & IP Detection

### Automatic IP Detection

When you set `restrict_ssh_to_current_ip = true` in `terraform.tfvars`, Terraform will:

1. **Automatically detect your public IP** using `https://ifconfig.me/ip`
2. **Restrict SSH access** (port 22) to only your IP address
3. **Restrict RCON access** (port 25575) to only your IP address
4. **Allow game traffic** (ports 8211, 27015, 80) from anywhere

### Enable SSH Restriction (Recommended)

Edit `terraform.tfvars`:

```hcl
restrict_ssh_to_current_ip = true
```

Then apply:

```bash
terraform apply
```

Terraform will automatically:
- Fetch your current public IP
- Configure security group to allow SSH only from: `YOUR_IP/32`

### Check Your Detected IP

After applying, view your detected IP:

```bash
terraform output ssh_access_info
```

Output example:
```json
{
  "restriction": "enabled",
  "allowed_ip": "123.45.67.89/32",
  "note": "SSH restricted to your current IP address"
}
```

### What Gets Restricted

When `restrict_ssh_to_current_ip = true`:

| Port | Service | Restriction |
|------|---------|-------------|
| 22 | SSH | âœ… Your IP only |
| 25575 | RCON | âœ… Your IP only |
| 8211 | Game Server | âŒ Open to all (players need this) |
| 27015 | Steam Query | âŒ Open to all |
| 80 | Dashboard | âŒ Open to all |

### Dynamic IP Changes

If your home internet IP changes:

**Option 1: Re-apply Terraform**
```bash
terraform apply
```
Terraform will detect your new IP and update the security group automatically.

**Option 2: Manually Update Security Group**
```bash
# Get your new IP
curl https://ifconfig.me/ip

# Update security group via AWS CLI
aws ec2 authorize-security-group-ingress \
  --group-id sg-XXXXX \
  --protocol tcp \
  --port 22 \
  --cidr YOUR_NEW_IP/32 \
  --region us-west-1
```

**Option 3: Use AWS Console**
1. Go to EC2 â†’ Security Groups
2. Find `palworld-server-sg`
3. Edit inbound rules
4. Update SSH rule with your new IP

## Remote State Setup

Store your Terraform state in S3 for safety and team collaboration.

### Benefits

- âœ… **Disaster Recovery**: Survive local machine loss
- âœ… **State Backup**: Automatic backups via S3 versioning
- âœ… **Encryption**: State encrypted at rest
- âœ… **Team Collaboration**: Multiple developers can work together (if needed later)
- âœ… **Cost**: < $0.02/month

### Setup Instructions

#### Step 1: Enable S3 Bucket Versioning

```bash
aws s3api put-bucket-versioning \
  --bucket palworld-tf-state \
  --versioning-configuration Status=Enabled \
  --region us-west-1
```

#### Step 2: Enable S3 Encryption

```bash
aws s3api put-bucket-encryption \
  --bucket palworld-tf-state \
  --server-side-encryption-configuration '{
    "Rules": [{
      "ApplyServerSideEncryptionByDefault": {
        "SSEAlgorithm": "AES256"
      }
    }]
  }' \
  --region us-west-1
```

#### Step 3: First Terraform Apply

```bash
# Initialize and apply
terraform init
terraform apply

# State is still stored locally for now
```

#### Step 4: Enable S3 Backend

```bash
# Edit backend-config.tf and uncomment the backend block
sed -i 's/^\/\*//' backend-config.tf
sed -i 's/^\*\///' backend-config.tf

# Or manually uncomment lines 31-43 in backend-config.tf
```

#### Step 5: Migrate State to S3

```bash
# Reinitialize Terraform with new backend
terraform init -migrate-state

# Type: yes when prompted
```

#### Step 6: Verify Migration

```bash
# Check state is in S3
aws s3 ls s3://palworld-tf-state/palworld-server/

# You should see: terraform.tfstate
```

#### Step 7: Cleanup Local State (Optional)

```bash
# ONLY after verifying S3 state works!
rm terraform.tfstate
rm terraform.tfstate.backup
```

### Accessing State from Another Machine

```bash
# 1. Clone the repo
git clone <your-repo>
cd palworld-server

# 2. Configure AWS credentials
source .env

# 3. Initialize Terraform (downloads state from S3)
terraform init

# 4. Ready to work!
terraform show
```

## Management

### SSH Access

```bash
ssh -i palworld-server-key.pem ubuntu@<SERVER_IP>
```

### View Server Logs

```bash
# Palworld server logs
docker logs palworld-server -f

# System logs
journalctl -xu palworld -f

# User-data initialization logs
sudo cat /var/log/user-data.log
```

### Restart Server

```bash
sudo systemctl restart palworld
```

### Manual Backup

```bash
sudo /usr/local/bin/backup-palworld.sh
```

### Check Backups in S3

```bash
aws s3 ls s3://$(terraform output -raw backup_bucket_name)/backups/ --region us-west-1
```

### Stop Server (Save Credits)

```bash
# Stop the instance (keeps infrastructure, stops EC2 billing)
aws autoscaling set-desired-capacity \
  --auto-scaling-group-name palworld-server-asg \
  --desired-capacity 0 \
  --region us-west-1
```

**Cost while stopped**:
- EC2: $0 (instance stopped)
- EBS: ~$4.80/month (volume persists)
- S3: ~$1/month (backups)
- Secrets Manager (2 secrets): ~$0.80/month
- **Total: ~$6.60/month**

### Start Server Again

```bash
aws autoscaling set-desired-capacity \
  --auto-scaling-group-name palworld-server-asg \
  --desired-capacity 1 \
  --region us-west-1
```

Server will restore from persistent EBS volume and be ready in ~5 minutes.

### Destroy Everything

```bash
terraform destroy
```

Type `yes` to confirm. Removes ALL resources including backups.

**âš ï¸ WARNING**: This deletes your game saves! Manually backup S3 bucket first if needed.

## Monitoring

### Web Dashboard

Access at: `http://<SERVER_IP>`

Shows real-time:
- Server status (online/offline)
- Player count
- CPU usage
- Memory usage

### CloudWatch Metrics

View in AWS Console:
- EC2 CPU utilization
- Memory usage (via CloudWatch agent)
- Disk usage

### Spot Instance Status

Check if Spot instance is at risk of interruption:

```bash
# SSH into server
ssh -i palworld-server-key.pem ubuntu@<SERVER_IP>

# Check for interruption warning
curl http://169.254.169.254/latest/meta-data/spot/instance-action
```

No output = safe. If there's output, instance will terminate in ~2 minutes.

## Troubleshooting

### Server not starting

```bash
# SSH into server
ssh -i palworld-server-key.pem ubuntu@<SERVER_IP>

# Check initialization logs
sudo tail -f /var/log/user-data.log

# Check Docker status
docker ps
docker logs palworld-server

# Check disk space
df -h
```

### Can't connect to server

1. **Check security group**: Ports 8211 (UDP), 27015 (UDP) must be open
2. **Check server status**: Visit dashboard at `http://<SERVER_IP>`
3. **Verify password**: Must match `terraform output -raw server_password`
4. **Check firewall**: Some ISPs block game ports

### Dashboard not loading

```bash
# SSH into server
sudo systemctl status nginx
sudo systemctl status palworld-metrics.timer

# Check metrics
curl http://localhost/metrics
```

### Spot instance keeps terminating

- Try different times (lower demand = less interruptions)
- Consider switching to on-demand (remove `instance_market_options` in compute.tf)
- Use lower Spot price to get more stable capacity pools

### "I lost my passwords!"

No problem! They're in AWS Secrets Manager:

```bash
aws secretsmanager get-secret-value \
  --secret-id $(terraform output -raw secrets_manager_name) \
  --region us-west-1 \
  --query SecretString --output text | jq .
```

Or retrieve from Terraform state:
```bash
terraform output -raw server_password
terraform output -raw admin_password
```

### Recovering SSH Key

If you lost your local `palworld-server-key.pem` file, retrieve it from AWS Secrets Manager:

**Option 1: Via AWS CLI**
```bash
# Get the private key
aws secretsmanager get-secret-value \
  --secret-id $(terraform output -raw ssh_key_secret_name) \
  --region us-west-1 \
  --query SecretString \
  --output text | jq -r .private_key > palworld-server-key.pem

# Set correct permissions
chmod 400 palworld-server-key.pem

# Test SSH connection
ssh -i palworld-server-key.pem ubuntu@$(terraform output -raw server_public_ip)
```

**Option 2: Via AWS Console**
1. AWS Console â†’ Secrets Manager
2. Find secret: `palworld-server-ssh-key-*`
3. Click "Retrieve secret value"
4. Copy the `private_key` field value
5. Save to `palworld-server-key.pem`
6. Run: `chmod 400 palworld-server-key.pem`

**Option 3: From Another Machine with Terraform**
```bash
# If you have the Terraform project on another machine
terraform output -raw ssh_private_key_path
# Points to the local key file

# Or extract from state
terraform show -json | jq -r '.values.root_module.resources[] | select(.address=="tls_private_key.palworld_ssh") | .values.private_key_openssh' > palworld-server-key.pem
chmod 400 palworld-server-key.pem
```

### "I'm locked out - IP changed"

**Via AWS Console**:
1. AWS Console â†’ EC2 â†’ Security Groups
2. Find `palworld-server-sg`
3. Edit inbound rules
4. Change SSH rule to `0.0.0.0/0` temporarily
5. SSH in and run `terraform apply`

**Via AWS CLI**:
```bash
# Get current security group ID
SG_ID=$(aws ec2 describe-security-groups --filters "Name=tag:Name,Values=palworld-server-sg" --query "SecurityGroups[0].GroupId" --output text --region us-west-1)

# Revoke old rule
aws ec2 revoke-security-group-ingress --group-id $SG_ID --protocol tcp --port 22 --cidr OLD_IP/32 --region us-west-1

# Add new rule
aws ec2 authorize-security-group-ingress --group-id $SG_ID --protocol tcp --port 22 --cidr $(curl -s https://ifconfig.me)/32 --region us-west-1
```

### "Error fetching IP address"

Terraform couldn't reach `ifconfig.me`. Solutions:

1. **Test connectivity:**
   ```bash
   curl -v https://ifconfig.me/ip
   ```

2. **Try alternative service** - Edit `data.tf`:
   ```hcl
   data "http" "current_ip" {
     url = "https://api.ipify.org"
   }
   ```

3. **Temporarily disable restriction:**
   ```hcl
   restrict_ssh_to_current_ip = false
   ```

## Security Best Practices

### Essential Security

1. **Rotate AWS credentials** after setup (they were in chat):
   ```bash
   aws iam create-access-key --user-name <your-username>
   aws iam delete-access-key --access-key-id AKIAQY5BT6TYVCOTGB5Q
   ```

2. **Update `.env` with new credentials**

3. **Restrict SSH to your IP**:
   ```hcl
   restrict_ssh_to_current_ip = true
   ```

4. **Use strong passwords** (auto-generated by Terraform)

5. **Enable MFA** on your AWS account

6. **Never commit `.env` or `*.pem` files** to git (already in .gitignore)

### Advanced Security

- **Enable CloudTrail** for audit logging
- **Set up billing alerts** at $20, $50, $75
- **Review IAM policies** regularly
- **Enable S3 bucket versioning** for backups
- **Use separate AWS account** for game servers (isolate from other resources)

## Customization

### Change Max Players

Edit `terraform.tfvars`:
```hcl
palworld_max_players = 20
```

Then run `terraform apply` to update.

**Note**: 16GB RAM supports ~10-20 players. For 32 players, use `t3.2xlarge` (32GB RAM, ~$80/month Spot).

### Change Backup Frequency

```hcl
backup_cron_schedule = "0 */4 * * *"  # Every 4 hours
```

### Change Region

1. Edit `terraform.tfvars`:
   ```hcl
   aws_region = "us-east-1"
   ```

2. Update `.env`:
   ```bash
   AWS_REGION=us-east-1
   AWS_DEFAULT_REGION=us-east-1
   ```

3. Re-run `terraform apply`

### Disable Web Dashboard

```hcl
enable_dashboard = false
```

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPC (10.0.0.0/16)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Public Subnet (10.0.1.0/24)             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  EC2 Spot t3.xlarge                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Docker + Palworld Server        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Nginx Dashboard                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - CloudWatch Agent                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Persistent EBS Volume (50GB)    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚           â”‚                                â”‚  â”‚
â”‚  â”‚     Elastic IP (Static)                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â”‚                    â”œâ”€â”€â”€â”€â”€> S3 Backups
         â”‚                    â””â”€â”€â”€â”€â”€> Secrets Manager
         â”‚
    Internet Gateway
         â”‚
    Public Internet
```

**Key Components:**
- **Auto Scaling Group**: Manages Spot instance lifecycle, auto-recovery
- **EBS Volume**: 50GB persistent storage for game saves (survives Spot interruptions)
- **Elastic IP**: Static public IP address
- **Lambda Functions**: Attach EBS volume on launch
- **S3 Bucket**: Automated backups with lifecycle policies
- **Secrets Manager**: Encrypted password & SSH key storage (2 secrets)
- **CloudWatch**: Metrics, logs, and alarms

## File Structure

```
palworld-server/
â”œâ”€â”€ main.tf                    # Core Terraform config, providers, passwords
â”œâ”€â”€ variables.tf               # Input variables
â”œâ”€â”€ outputs.tf                 # Output values
â”œâ”€â”€ data.tf                    # Data sources (IP detection)
â”œâ”€â”€ network.tf                 # VPC, subnets, security groups
â”œâ”€â”€ compute.tf                 # EC2, ASG, Launch Template
â”œâ”€â”€ storage.tf                 # EBS volume, S3 bucket, Elastic IP
â”œâ”€â”€ secrets.tf                 # AWS Secrets Manager for passwords
â”œâ”€â”€ iam.tf                     # IAM roles and policies
â”œâ”€â”€ lambda_functions.tf        # Lambda resources
â”œâ”€â”€ monitoring.tf              # CloudWatch, EventBridge
â”œâ”€â”€ backend.tf                 # Remote state configuration
â”œâ”€â”€ backend-config.tf          # S3 backend setup (commented)
â”œâ”€â”€ user-data.sh               # EC2 initialization script
â”œâ”€â”€ .env                       # AWS credentials (DO NOT COMMIT)
â”œâ”€â”€ .gitignore                 # Git ignore rules
â”œâ”€â”€ terraform.tfvars           # Your configuration
â”œâ”€â”€ terraform.tfvars.example   # Example variables
â”œâ”€â”€ verify.sh                  # Pre-deployment checker
â”œâ”€â”€ lambda/
â”‚   â”œâ”€â”€ volume_attachment.py   # EBS attachment handler
â”‚   â””â”€â”€ spot_interruption.py   # Spot interruption handler
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ index.html             # Monitoring dashboard UI
â”‚   â””â”€â”€ dashboard.js           # Dashboard JavaScript
â””â”€â”€ config/
    â””â”€â”€ PalWorldSettings.ini.example  # Server settings reference
```

## Support

### Palworld Server Issues
- [Palworld Official Docs](https://tech.palworldgame.com/)
- [Docker Image Docs](https://github.com/thijsvanloef/palworld-server-docker)

### AWS Issues
- [AWS Support](https://console.aws.amazon.com/support/)
- [Terraform AWS Provider Docs](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)

### Infrastructure Issues
- Check CloudWatch logs: AWS Console â†’ CloudWatch â†’ Log Groups
- Review Terraform state: `terraform show`
- Validate config: `terraform validate`

## Credits

- Palworld Server Docker: [thijsvanloef/palworld-server-docker](https://github.com/thijsvanloef/palworld-server-docker)
- Inspired by: [TheSudoYT/terraform-aws-palworld](https://github.com/TheSudoYT/terraform-aws-palworld)

---

**Enjoy your Palworld server!** ğŸ®

For questions or issues, review the troubleshooting section above or check AWS CloudWatch logs.
